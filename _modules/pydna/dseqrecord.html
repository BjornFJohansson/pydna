

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pydna.dseqrecord &mdash; pydna 6.0.0a24.post17+b7b559bd66 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=7ab3649f" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=a051be83" />

  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=6efefdf6"></script>
      <script src="../../_static/doctools.js?v=888ff710"></script>
      <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pydna
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Pydna</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/index.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../example_gallery.html">Example gallery</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pydna</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../pydna.html">pydna</a></li>
      <li class="breadcrumb-item active">pydna.dseqrecord</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pydna.dseqrecord</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Copyright 2013-2023 by Bj√∂rn Johansson.  All rights reserved.</span>
<span class="c1"># This code is part of the Python-dna distribution and governed by its</span>
<span class="c1"># license.  Please see the LICENSE.txt file that should have been included</span>
<span class="c1"># as part of this package.</span>
<span class="sd">&quot;&quot;&quot;This module provides the :class:`Dseqrecord` class, for handling double stranded</span>
<span class="sd">DNA sequences. The Dseqrecord holds sequence information in the form of a :class:`pydna.dseq.Dseq`</span>
<span class="sd">object. The Dseq and Dseqrecord classes are subclasses of Biopythons</span>
<span class="sd">Seq and SeqRecord classes, respectively.</span>

<span class="sd">The Dseq and Dseqrecord classes support the notion of circular and linear DNA topology.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">Bio.Restriction</span> <span class="kn">import</span> <span class="n">RestrictionBatch</span> <span class="k">as</span> <span class="n">_RestrictionBatch</span>
<span class="kn">from</span> <span class="nn">Bio.Restriction</span> <span class="kn">import</span> <span class="n">CommOnly</span>
<span class="kn">from</span> <span class="nn">pydna.dseq</span> <span class="kn">import</span> <span class="n">Dseq</span> <span class="k">as</span> <span class="n">_Dseq</span>
<span class="kn">from</span> <span class="nn">pydna._pretty</span> <span class="kn">import</span> <span class="n">pretty_str</span> <span class="k">as</span> <span class="n">_pretty_str</span>
<span class="kn">from</span> <span class="nn">pydna.utils</span> <span class="kn">import</span> <span class="n">flatten</span> <span class="k">as</span> <span class="n">_flatten</span><span class="p">,</span> <span class="n">location_boundaries</span> <span class="k">as</span> <span class="n">_location_boundaries</span>

<span class="c1"># from pydna.utils import memorize as _memorize</span>
<span class="kn">from</span> <span class="nn">pydna.utils</span> <span class="kn">import</span> <span class="n">rc</span> <span class="k">as</span> <span class="n">_rc</span>
<span class="kn">from</span> <span class="nn">pydna.utils</span> <span class="kn">import</span> <span class="n">shift_location</span> <span class="k">as</span> <span class="n">_shift_location</span>
<span class="kn">from</span> <span class="nn">pydna.utils</span> <span class="kn">import</span> <span class="n">shift_feature</span> <span class="k">as</span> <span class="n">_shift_feature</span>
<span class="kn">from</span> <span class="nn">pydna.common_sub_strings</span> <span class="kn">import</span> <span class="n">common_sub_strings</span> <span class="k">as</span> <span class="n">_common_sub_strings</span>
<span class="kn">from</span> <span class="nn">Bio.SeqFeature</span> <span class="kn">import</span> <span class="n">SeqFeature</span> <span class="k">as</span> <span class="n">_SeqFeature</span>
<span class="kn">from</span> <span class="nn">Bio</span> <span class="kn">import</span> <span class="n">SeqIO</span>
<span class="kn">from</span> <span class="nn">Bio.SeqFeature</span> <span class="kn">import</span> <span class="n">CompoundLocation</span> <span class="k">as</span> <span class="n">_CompoundLocation</span>
<span class="kn">from</span> <span class="nn">Bio.SeqFeature</span> <span class="kn">import</span> <span class="n">SimpleLocation</span> <span class="k">as</span> <span class="n">_SimpleLocation</span>
<span class="kn">from</span> <span class="nn">pydna.seqrecord</span> <span class="kn">import</span> <span class="n">SeqRecord</span> <span class="k">as</span> <span class="n">_SeqRecord</span>
<span class="kn">from</span> <span class="nn">Bio.Seq</span> <span class="kn">import</span> <span class="n">translate</span> <span class="k">as</span> <span class="n">_translate</span>
<span class="kn">from</span> <span class="nn">pydna.utils</span> <span class="kn">import</span> <span class="n">identifier_from_string</span> <span class="k">as</span> <span class="n">_identifier_from_string</span>
<span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">_copy</span>
<span class="kn">import</span> <span class="nn">operator</span> <span class="k">as</span> <span class="nn">_operator</span>
<span class="kn">import</span> <span class="nn">os</span> <span class="k">as</span> <span class="nn">_os</span>
<span class="kn">import</span> <span class="nn">re</span> <span class="k">as</span> <span class="nn">_re</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="k">as</span> <span class="nn">_time</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">_datetime</span>


<span class="kn">import</span> <span class="nn">logging</span> <span class="k">as</span> <span class="nn">_logging</span>

<span class="n">_module_logger</span> <span class="o">=</span> <span class="n">_logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;pydna.&quot;</span> <span class="o">+</span> <span class="vm">__name__</span><span class="p">)</span>


<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display_html</span> <span class="k">as</span> <span class="n">_display_html</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">_display_html</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span>


<div class="viewcode-block" id="Dseqrecord"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord">[docs]</a><span class="k">class</span> <span class="nc">Dseqrecord</span><span class="p">(</span><span class="n">_SeqRecord</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dseqrecord is a double stranded version of the Biopython SeqRecord [#]_ class.</span>
<span class="sd">    The Dseqrecord object holds a Dseq object describing the sequence.</span>
<span class="sd">    Additionally, Dseqrecord hold meta information about the sequence in the</span>
<span class="sd">    from of a list of SeqFeatures, in the same way as the SeqRecord does.</span>

<span class="sd">    The Dseqrecord can be initialized with a string, Seq, Dseq, SeqRecord</span>
<span class="sd">    or another Dseqrecord. The sequence information will be stored in a</span>
<span class="sd">    Dseq object in all cases.</span>

<span class="sd">    Dseqrecord objects can be read or parsed from sequences in FASTA, EMBL or Genbank formats.</span>
<span class="sd">    See the :mod:`pydna.readers` and :mod:`pydna.parsers` modules for further information.</span>

<span class="sd">    There is a short representation associated with the Dseqrecord.</span>
<span class="sd">    ``Dseqrecord(-3)`` represents a linear sequence of length 2</span>
<span class="sd">    while ``Dseqrecord(o7)``</span>
<span class="sd">    represents a circular sequence of length 7.</span>

<span class="sd">    Dseqrecord and Dseq share the same concept of length. This length can be larger</span>
<span class="sd">    than each strand alone if they are staggered as in the example below.</span>

<span class="sd">    ::</span>

<span class="sd">        &lt;-- length --&gt;</span>
<span class="sd">        GATCCTTT</span>
<span class="sd">             AAAGCCTAG</span>




<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    record  : string, Seq, SeqRecord, Dseq or other Dseqrecord object</span>
<span class="sd">        This data will be used to form the seq property</span>

<span class="sd">    circular : bool, optional</span>
<span class="sd">        True or False reflecting the shape of the DNA molecule</span>

<span class="sd">    linear : bool, optional</span>
<span class="sd">        True or False reflecting the shape of the DNA molecule</span>


<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">    &gt;&gt;&gt; a=Dseqrecord(&quot;aaa&quot;)</span>
<span class="sd">    &gt;&gt;&gt; a</span>
<span class="sd">    Dseqrecord(-3)</span>
<span class="sd">    &gt;&gt;&gt; a.seq</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>
<span class="sd">    &gt;&gt;&gt; from pydna.seq import Seq</span>
<span class="sd">    &gt;&gt;&gt; b=Dseqrecord(Seq(&quot;aaa&quot;))</span>
<span class="sd">    &gt;&gt;&gt; b</span>
<span class="sd">    Dseqrecord(-3)</span>
<span class="sd">    &gt;&gt;&gt; b.seq</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>
<span class="sd">    &gt;&gt;&gt; from Bio.SeqRecord import SeqRecord</span>
<span class="sd">    &gt;&gt;&gt; c=Dseqrecord(SeqRecord(Seq(&quot;aaa&quot;)))</span>
<span class="sd">    &gt;&gt;&gt; c</span>
<span class="sd">    Dseqrecord(-3)</span>
<span class="sd">    &gt;&gt;&gt; c.seq</span>
<span class="sd">    Dseq(-3)</span>
<span class="sd">    aaa</span>
<span class="sd">    ttt</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [#] http://biopython.org/wiki/SeqRecord</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">record</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">circular</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">n</span><span class="o">=</span><span class="mf">5e-14</span><span class="p">,</span>  <span class="c1"># mol ( = 0.05 pmol)</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">_module_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;### Dseqrecord initialized ###&quot;</span><span class="p">)</span>
        <span class="n">_module_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;argument circular = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">circular</span><span class="p">)</span>
        <span class="n">_module_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;circular = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">circular</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">_module_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;record is a string&quot;</span><span class="p">)</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">_Dseq</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span>
                    <span class="n">record</span><span class="p">,</span>
                    <span class="c1"># linear=linear,</span>
                    <span class="n">circular</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">circular</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># record is a Dseq object ?</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s2">&quot;watson&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">circular</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">record</span><span class="p">[:]</span>
            <span class="k">elif</span> <span class="n">circular</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">record</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">looped</span><span class="p">()</span>
            <span class="n">_module_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;record is a Dseq object&quot;</span><span class="p">)</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># record is a Bio.Seq object ?</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s2">&quot;transcribe&quot;</span><span class="p">):</span>
            <span class="n">_module_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;record is a Seq object&quot;</span><span class="p">)</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">_Dseq</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">),</span>
                    <span class="c1"># linear=linear,</span>
                    <span class="n">circular</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">circular</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># record is a Bio.SeqRecord or Dseqrecord object ?</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">):</span>
            <span class="n">_module_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;record is a Bio.SeqRecord or Dseqrecord object&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">letter_annotations</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c1"># record.seq is a Dseq object ?</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span> <span class="s2">&quot;watson&quot;</span><span class="p">):</span>
                <span class="n">new_seq</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">circular</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="n">new_seq</span> <span class="o">=</span> <span class="n">new_seq</span><span class="p">[:]</span>
                <span class="k">elif</span> <span class="n">circular</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">new_seq</span> <span class="o">=</span> <span class="n">new_seq</span><span class="o">.</span><span class="n">looped</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">new_seq</span>
            <span class="c1"># record.seq is Bio.SeqRecord object ?</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">_Dseq</span><span class="p">(</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span>
                    <span class="c1"># linear=linear,</span>
                    <span class="n">circular</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">circular</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;don&#39;t know what to do with </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">map_target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>  <span class="c1"># amount, set to 5E-14 which is 5 pmols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;molecule_type&quot;</span><span class="p">:</span> <span class="s2">&quot;DNA&quot;</span><span class="p">})</span>

<div class="viewcode-block" id="Dseqrecord.from_string"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.from_string">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_string</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">record</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="c1"># linear=True,</span>
        <span class="n">circular</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">n</span><span class="o">=</span><span class="mf">5e-14</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="c1"># def from_string(cls, record:str=&quot;&quot;, *args,</span>
        <span class="c1"># linear=True, circular=False, n = 5E-14, **kwargs):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>  <span class="c1"># Does not call __init__</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_per_letter_annotations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">_Dseq</span><span class="o">.</span><span class="n">quick</span><span class="p">(</span>
            <span class="n">record</span><span class="p">,</span>
            <span class="n">_rc</span><span class="p">(</span><span class="n">record</span><span class="p">),</span>
            <span class="n">ovhg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="c1"># linear=linear,</span>
            <span class="n">circular</span><span class="o">=</span><span class="n">circular</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">_pretty_str</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">_pretty_str</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">_pretty_str</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">dbxrefs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">annotations</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;molecule_type&quot;</span><span class="p">:</span> <span class="s2">&quot;DNA&quot;</span><span class="p">}</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">map_target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">obj</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="Dseqrecord.from_SeqRecord"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.from_SeqRecord">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_SeqRecord</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">record</span><span class="p">:</span> <span class="n">_SeqRecord</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">circular</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">n</span><span class="o">=</span><span class="mf">5e-14</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>  <span class="c1"># Does not call __init__</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_per_letter_annotations</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">_per_letter_annotations</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">description</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">dbxrefs</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">dbxrefs</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">annotations</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;molecule_type&quot;</span><span class="p">:</span> <span class="s2">&quot;DNA&quot;</span><span class="p">}</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">annotations</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">features</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">map_target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="k">if</span> <span class="n">circular</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">circular</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;topology&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;circular&quot;</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">_Dseq</span><span class="o">.</span><span class="n">quick</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span> <span class="n">_rc</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">seq</span><span class="p">)),</span> <span class="n">ovhg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">circular</span><span class="o">=</span><span class="n">circular</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">circular</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The circular property can not be set directly.</span>
<span class="sd">        Use :meth:`looped`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">circular</span>

<div class="viewcode-block" id="Dseqrecord.m"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.m">[docs]</a>    <span class="k">def</span> <span class="nf">m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method returns the mass of the DNA molecule in grams. This is</span>
<span class="sd">        calculated as the product between the molecular weight of the Dseq object</span>
<span class="sd">        and the&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">mw</span><span class="p">()</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>  <span class="c1"># Da(g/mol) * mol = g</span></div>

<div class="viewcode-block" id="Dseqrecord.extract_feature"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.extract_feature">[docs]</a>    <span class="k">def</span> <span class="nf">extract_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extracts a feature and creates a new Dseqrecord object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n  : int</span>
<span class="sd">            Indicates the feature to extract</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;atgtaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.add_feature(2,4)</span>
<span class="sd">        &gt;&gt;&gt; b=a.extract_feature(0)</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseqrecord(-2)</span>
<span class="sd">        &gt;&gt;&gt; b.seq</span>
<span class="sd">        Dseq(-2)</span>
<span class="sd">        gt</span>
<span class="sd">        ca</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">extract_feature</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.add_feature"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.add_feature">[docs]</a>    <span class="k">def</span> <span class="nf">add_feature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="s2">&quot;misc&quot;</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a feature of type misc to the feature list of the sequence.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x  : int</span>
<span class="sd">            Indicates start of the feature</span>
<span class="sd">        y  : int</span>
<span class="sd">            Indicates end of the feature</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pydna.seqrecord import SeqRecord</span>
<span class="sd">        &gt;&gt;&gt; a=SeqRecord(&quot;atgtaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.features</span>
<span class="sd">        []</span>
<span class="sd">        &gt;&gt;&gt; a.add_feature(2,4)</span>
<span class="sd">        &gt;&gt;&gt; a.features</span>
<span class="sd">        [SeqFeature(SimpleLocation(ExactPosition(2), ExactPosition(4), strand=1), type=&#39;misc&#39;, qualifiers=...)]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">qualifiers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">qualifiers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">location</span> <span class="o">=</span> <span class="n">_CompoundLocation</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">_SimpleLocation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">length</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">),</span>
                <span class="n">_SimpleLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="n">sf</span> <span class="o">=</span> <span class="n">_SeqFeature</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">type_</span><span class="p">,</span> <span class="n">qualifiers</span><span class="o">=</span><span class="n">qualifiers</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">qualifiers</span><span class="p">:</span>
            <span class="n">qualifiers</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ft</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">location</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">sf</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">isorf</span><span class="p">():</span>
            <span class="n">qualifiers</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;orf</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">location</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.seguid"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.seguid">[docs]</a>    <span class="k">def</span> <span class="nf">seguid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Url safe SEGUID for the sequence.</span>

<span class="sd">        This checksum is the same as seguid but with base64.urlsafe</span>
<span class="sd">        encoding instead of the normal base64. This means that</span>
<span class="sd">        the characters + and / are replaced with - and _ so that</span>
<span class="sd">        the checksum can be part of a URL.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a = Dseqrecord(&quot;aa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a.seguid()</span>
<span class="sd">        &#39;ldseguid=TEwydy0ugvGXh3VJnVwgtxoyDQA&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">seguid</span><span class="p">()</span></div>

<div class="viewcode-block" id="Dseqrecord.looped"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.looped">[docs]</a>    <span class="k">def</span> <span class="nf">looped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Circular version of the Dseqrecord object.</span>

<span class="sd">        The underlying linear Dseq object has to have compatible ends.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;aaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseqrecord(-3)</span>
<span class="sd">        &gt;&gt;&gt; b=a.looped()</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseqrecord(o3)</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pydna.dseq.Dseq.looped</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># for key, value in list(self.__dict__.items()):</span>
        <span class="c1">#     setattr(new, key, value)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">looped</span><span class="p">()</span>
        <span class="n">five_prime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">five_prime_end</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">five_prime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;5&#39;&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c1"># fn.location = fn.location + self.seq.ovhg</span>
            <span class="k">elif</span> <span class="n">five_prime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;3&#39;&quot;</span><span class="p">:</span>
                <span class="n">fn</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">location</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">loc1</span> <span class="o">=</span> <span class="n">_SimpleLocation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">)</span> <span class="o">+</span> <span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">),</span> <span class="n">strand</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="p">)</span>
                <span class="n">loc2</span> <span class="o">=</span> <span class="n">_SimpleLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="p">)</span>
                <span class="n">fn</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">_CompoundLocation</span><span class="p">([</span><span class="n">loc1</span><span class="p">,</span> <span class="n">loc2</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">):</span>
                <span class="n">loc1</span> <span class="o">=</span> <span class="n">_SimpleLocation</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">),</span> <span class="n">strand</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="p">)</span>
                <span class="n">loc2</span> <span class="o">=</span> <span class="n">_SimpleLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">new</span><span class="p">),</span> <span class="n">strand</span><span class="o">=</span><span class="n">fn</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span><span class="p">)</span>
                <span class="n">fn</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">_CompoundLocation</span><span class="p">([</span><span class="n">loc1</span><span class="p">,</span> <span class="n">loc2</span><span class="p">])</span>

            <span class="n">fn</span><span class="o">.</span><span class="n">qualifiers</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">qualifiers</span>

        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Dseqrecord.tolinear"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.tolinear">[docs]</a>    <span class="k">def</span> <span class="nf">tolinear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a linear, blunt copy of a circular Dseqrecord object. The</span>
<span class="sd">        underlying Dseq object has to be circular.</span>

<span class="sd">        This method is deprecated, use slicing instead. See example below.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;aaa&quot;, circular = True)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseqrecord(o3)</span>
<span class="sd">        &gt;&gt;&gt; b=a[:]</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseqrecord(-3)</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">warnings</span> <span class="k">as</span> <span class="nn">_warnings</span>
        <span class="kn">from</span> <span class="nn">pydna</span> <span class="kn">import</span> <span class="n">_PydnaDeprecationWarning</span>

        <span class="n">_warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;tolinear method is obsolete; &quot;</span> <span class="s2">&quot;please use obj[:] &quot;</span> <span class="s2">&quot;instead of obj.tolinear().&quot;</span><span class="p">,</span>
            <span class="n">_PydnaDeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="c1"># new._seq = self.seq.tolinear()</span>
        <span class="k">for</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fo</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">new</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">):</span>
            <span class="n">fn</span><span class="o">.</span><span class="n">qualifiers</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">qualifiers</span>

        <span class="k">return</span> <span class="n">new</span></div>

<div class="viewcode-block" id="Dseqrecord.terminal_transferase"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.terminal_transferase">[docs]</a>    <span class="k">def</span> <span class="nf">terminal_transferase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucleotides</span><span class="o">=</span><span class="s2">&quot;a&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="n">newseq</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">newseq</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">terminal_transferase</span><span class="p">(</span><span class="n">nucleotides</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">newseq</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">feature</span><span class="o">.</span><span class="n">location</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nucleotides</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">newseq</span></div>

<div class="viewcode-block" id="Dseqrecord.format"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.format">[docs]</a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s2">&quot;gb&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the sequence as a string using a format supported by Biopython</span>
<span class="sd">        SeqIO [#]_. Default is &quot;gb&quot; which is short for Genbank.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; x=Dseqrecord(&quot;aaa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; x.annotations[&#39;date&#39;] = &#39;02-FEB-2013&#39;</span>
<span class="sd">        &gt;&gt;&gt; x</span>
<span class="sd">        Dseqrecord(-3)</span>
<span class="sd">        &gt;&gt;&gt; print(x.format(&quot;gb&quot;))</span>
<span class="sd">        LOCUS       name                       3 bp    DNA     linear   UNK 02-FEB-2013</span>
<span class="sd">        DEFINITION  description.</span>
<span class="sd">        ACCESSION   id</span>
<span class="sd">        VERSION     id</span>
<span class="sd">        KEYWORDS    .</span>
<span class="sd">        SOURCE      .</span>
<span class="sd">          ORGANISM  .</span>
<span class="sd">                    .</span>
<span class="sd">        FEATURES             Location/Qualifiers</span>
<span class="sd">        ORIGIN</span>
<span class="sd">                1 aaa</span>
<span class="sd">        //</span>


<span class="sd">        References</span>
<span class="sd">        ----------</span>

<span class="sd">        .. [#] http://biopython.org/wiki/SeqIO</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">record</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;genbank&quot;</span><span class="p">,</span> <span class="s2">&quot;gb&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="s2">&quot;topology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;circular&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="s2">&quot;topology&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
        <span class="k">return</span> <span class="n">_SeqRecord</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="Dseqrecord.write"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s2">&quot;gb&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Writes the Dseqrecord to a file using the format f, which must</span>
<span class="sd">        be a format supported by Biopython SeqIO for writing [#]_. Default</span>
<span class="sd">        is &quot;gb&quot; which is short for Genbank. Note that Biopython SeqIO reads</span>
<span class="sd">        more formats than it writes.</span>

<span class="sd">        Filename is the path to the file where the sequece is to be</span>
<span class="sd">        written. The filename is optional, if it is not given, the</span>
<span class="sd">        description property (string) is used together with the format.</span>

<span class="sd">        If obj is the Dseqrecord object, the default file name will be:</span>

<span class="sd">        ``&lt;obj.locus&gt;.&lt;f&gt;``</span>

<span class="sd">        Where &lt;f&gt; is &quot;gb&quot; by default. If the filename already exists and</span>
<span class="sd">        AND the sequence it contains is different, a new file name will be</span>
<span class="sd">        used so that the old file is not lost:</span>

<span class="sd">        ``&lt;obj.locus&gt;_NEW.&lt;f&gt;``</span>

<span class="sd">        References</span>
<span class="sd">        ----------</span>
<span class="sd">        .. [#] http://biopython.org/wiki/SeqIO</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{name}</span><span class="s2">.</span><span class="si">{type}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">locus</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
            <span class="c1"># generate a name if no name was given</span>
        <span class="c1"># if not isinstance(filename, str):  # is filename a string???</span>
        <span class="c1">#     raise ValueError(&quot;filename has to be a string, got&quot;, type(filename))</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;font face=monospace&gt;&lt;a href=&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; target=&#39;_blank&#39;&gt;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&lt;/a&gt;&lt;/font&gt;&lt;br&gt;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">pydna.readers</span> <span class="kn">import</span> <span class="n">read</span>

            <span class="n">old_file</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">!=</span> <span class="n">old_file</span><span class="o">.</span><span class="n">seq</span><span class="p">:</span>
                <span class="c1"># If new sequence is different, the old file is</span>
                <span class="c1"># renamed with &quot;_OLD_&quot; suffix:</span>
                <span class="n">oldmtime</span> <span class="o">=</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                <span class="n">tstmp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1_000_000</span><span class="p">)</span>
                <span class="n">old_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">_OLD_</span><span class="si">{</span><span class="n">tstmp</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">_os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">old_filename</span><span class="p">)</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="n">newmtime</span> <span class="o">=</span> <span class="n">_datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">_os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;table style=&quot;padding:10px 10px;</span>
<span class="s2">                word-break:normal;</span>
<span class="s2">                border-color:#fe0000;</span>
<span class="s2">                border-collapse:collapse;</span>
<span class="s2">                border-spacing:1;</span>
<span class="s2">                font-family:monospace;</span>
<span class="s2">                font-size:large;</span>
<span class="s2">                font-weight:bold;</span>
<span class="s2">                text-align:left;</span>
<span class="s2">                border: 5px solid red;&quot;&gt;</span>
<span class="s2">                &lt;thead&gt;</span>
<span class="s2">                  &lt;tr style=&quot;color:#0000FF;border: 1px solid;text-align:left;&quot;&gt;</span>
<span class="s2">                    &lt;th style=&quot;color:#fe0000;border: 1px solid;text-align:center;font-size:xxx-large;text-align:left;&quot;&gt;&amp;#9888&lt;/th&gt;</span>
<span class="s2">                    &lt;th style=&quot;color:#f56b00;border: 1px solid;text-align:left;&quot; colspan=&quot;2&quot;&gt;Sequence change&lt;/th&gt;</span>
<span class="s2">                  &lt;/tr&gt;</span>
<span class="s2">                &lt;/thead&gt;</span>
<span class="s2">                &lt;tbody&gt;</span>
<span class="s2">                  &lt;tr style=&quot;color:#0000FF;border: 1px solid;text-align:left;&quot;&gt;</span>
<span class="s2">                    &lt;td&gt;Filename&lt;/td&gt;</span>
<span class="s2">                    &lt;td style=&quot;color:#fe0000;border: 1px solid;text-align:left;&quot;&gt;&lt;a href=&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&#39; target=&#39;_blank&#39;&gt;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&lt;/a&gt;&lt;/td&gt;</span>
<span class="s2">                    &lt;td style=&quot;color:#32cb00;border: 1px solid;text-align:left;&quot;&gt;&lt;a href=&#39;</span><span class="si">{</span><span class="n">old_filename</span><span class="si">}</span><span class="s2">&#39; target=&#39;_blank&#39;&gt;</span><span class="si">{</span><span class="n">old_filename</span><span class="si">}</span><span class="s2">&lt;/a&gt;&lt;/td&gt;</span>
<span class="s2">                  &lt;/tr&gt;</span>
<span class="s2">                  &lt;tr style=&quot;color:#0000FF;border: 1px solid;text-align:left;&quot;&gt;</span>
<span class="s2">                    &lt;td &gt;Saved&lt;/td&gt;</span>
<span class="s2">                    &lt;td style=&quot;color:#fe0000;border: 1px solid;text-align:left;&quot;&gt;</span><span class="si">{</span><span class="n">newmtime</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">                    &lt;td style=&quot;color:#32cb00;border: 1px solid;text-align:left;&quot;&gt;</span><span class="si">{</span><span class="n">oldmtime</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">                  &lt;/tr&gt;</span>
<span class="s2">                  &lt;tr style=&quot;color:#0000FF;border: 1px solid;text-align:left;&quot;&gt;</span>
<span class="s2">                    &lt;td&gt;Length&lt;/td&gt;</span>
<span class="s2">                    &lt;td style=&quot;color:#fe0000;border: 1px solid;text-align:left;&quot;&gt;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">                    &lt;td style=&quot;color:#32cb00;border: 1px solid;text-align:left;&quot;&gt;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">old_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">                  &lt;/tr&gt;</span>
<span class="s2">                  &lt;tr style=&quot;color:#0000FF;border: 1px solid;text-align:left;&quot;&gt;</span>
<span class="s2">                    &lt;td&gt;SEGUID&lt;/td&gt;</span>
<span class="s2">                    &lt;td style=&quot;color:#fe0000;border: 1px solid;text-align:left;&quot;&gt;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seguid</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">                    &lt;td style=&quot;color:#32cb00;border: 1px solid;text-align:left;&quot;&gt;</span><span class="si">{</span><span class="n">old_file</span><span class="o">.</span><span class="n">seguid</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/td&gt;</span>
<span class="s2">                  &lt;/tr&gt;</span>
<span class="s2">                &lt;/tbody&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">                &quot;&quot;&quot;</span>
            <span class="k">elif</span> <span class="s2">&quot;seguid&quot;</span> <span class="ow">in</span> <span class="n">old_file</span><span class="o">.</span><span class="n">annotations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(ldseguid|cdseguid)-(\S</span><span class="si">{27}</span><span class="s2">)(_[0-9]</span><span class="si">{4}</span><span class="s2">-[0-9]</span><span class="si">{2}</span><span class="s2">-[0-9]</span><span class="si">{2}</span><span class="s2">T[0-9]</span><span class="si">{2}</span><span class="s2">:[0-9]</span><span class="si">{2}</span><span class="s2">:[0-9]</span><span class="si">{2}</span><span class="s2">\.[0-9]</span><span class="si">{6}</span><span class="s2">){0,1}&quot;</span>
                <span class="c1"># seguid=NNNNNNNNNNNNNNNNNNNNNNNNNNN_2020-10-10T11:11:11.111111</span>
                <span class="n">oldstamp</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">old_file</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
                <span class="n">newstamp</span> <span class="o">=</span> <span class="n">_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>
                <span class="n">newdescription</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>
                <span class="k">if</span> <span class="n">oldstamp</span> <span class="ow">and</span> <span class="n">newstamp</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">oldstamp</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">35</span><span class="p">]</span> <span class="o">==</span> <span class="n">newstamp</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)[:</span><span class="mi">35</span><span class="p">]:</span>
                        <span class="n">newdescription</span> <span class="o">=</span> <span class="n">newdescription</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">newstamp</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">oldstamp</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">oldstamp</span><span class="p">:</span>
                    <span class="n">newdescription</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">oldstamp</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">newobj</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">newobj</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">newdescription</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">newobj</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_display_html</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.find"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.find">[docs]</a>    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># TODO allow strings, seqs, seqrecords or Dseqrecords</span>
        <span class="c1"># TODO check for linearity of other, raise exception if not</span>
        <span class="c1"># TODO add tests and docstring for this method</span>
        <span class="n">o</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># allow wrapping around origin</span>
            <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">o</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s2">&quot;Dseqrecord</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="s2">&quot;circular: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="s2">&quot;size: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="n">_SeqRecord</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(</span>
            <span class="bp">self</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">ln</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">spc</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">ln</span> <span class="o">%</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">ln</span> <span class="o">%</span> <span class="mi">3</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;n&quot;</span> <span class="o">*</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;nnn&quot;</span>
            <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">_translate</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">frame</span> <span class="p">:</span> <span class="n">frame</span> <span class="o">+</span> <span class="n">spc</span> <span class="o">+</span> <span class="n">ln</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="Dseqrecord.find_aminoacids"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.find_aminoacids">[docs]</a>    <span class="k">def</span> <span class="nf">find_aminoacids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; s=Dseqrecord(&quot;atgtacgatcgtatgctggttatattttag&quot;)</span>
<span class="sd">        &gt;&gt;&gt; s.seq.translate()</span>
<span class="sd">        Seq(&#39;MYDRMLVIF*&#39;)</span>
<span class="sd">        &gt;&gt;&gt; &quot;RML&quot; in s</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; &quot;MMM&quot; in s</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; s.seq.rc().translate()</span>
<span class="sd">        Seq(&#39;LKYNQHTIVH&#39;)</span>
<span class="sd">        &gt;&gt;&gt; &quot;QHT&quot; in s.rc()</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; &quot;QHT&quot; in s</span>
<span class="sd">        False</span>
<span class="sd">        &gt;&gt;&gt; slc = s.find_aa(&quot;RML&quot;)</span>
<span class="sd">        &gt;&gt;&gt; slc</span>
<span class="sd">        slice(9, 18, None)</span>
<span class="sd">        &gt;&gt;&gt; s[slc]</span>
<span class="sd">        Dseqrecord(-9)</span>
<span class="sd">        &gt;&gt;&gt; code = s[slc].seq</span>
<span class="sd">        &gt;&gt;&gt; code</span>
<span class="sd">        Dseq(-9)</span>
<span class="sd">        cgtatgctg</span>
<span class="sd">        gcatacgac</span>
<span class="sd">        &gt;&gt;&gt; code.translate()</span>
<span class="sd">        Seq(&#39;RML&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">other</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">spc</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">ln</span> <span class="o">%</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">ln</span> <span class="o">%</span> <span class="mi">3</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s2">&quot;n&quot;</span> <span class="o">*</span> <span class="n">spc</span> <span class="o">+</span> <span class="s2">&quot;nnn&quot;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">_translate</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">frame</span> <span class="p">:</span> <span class="n">frame</span> <span class="o">+</span> <span class="n">ln</span> <span class="o">+</span> <span class="n">spc</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="n">oh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># TODO return an emoty slice or False...?</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">slice</span><span class="p">(</span><span class="n">frame</span> <span class="o">+</span> <span class="n">start</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">oh</span><span class="p">,</span> <span class="n">frame</span> <span class="o">+</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">))</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">oh</span><span class="p">)</span></div>

    <span class="n">find_aa</span> <span class="o">=</span> <span class="n">find_aminoacids</span>

<div class="viewcode-block" id="Dseqrecord.map_trace_files"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.map_trace_files">[docs]</a>    <span class="k">def</span> <span class="nf">map_trace_files</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pth</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>  <span class="c1"># TODO allow path-like objects</span>
        <span class="kn">import</span> <span class="nn">glob</span>

        <span class="n">traces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pth</span><span class="p">):</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="n">SeqIO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;abi&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">trace</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">name</span>
            <span class="n">traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">traces</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No trace files found in </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pth</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_target</span><span class="p">,</span> <span class="s2">&quot;step&quot;</span><span class="p">):</span>
            <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_target</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_target</span><span class="p">,</span> <span class="s2">&quot;extract&quot;</span><span class="p">):</span>
            <span class="n">area</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">map_target</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_target</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">area</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># TODO allow other objects as well and do some checks on map target</span>

        <span class="k">if</span> <span class="n">area</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matching_reads</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">not_matching_reads</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">target</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">area</span><span class="p">]</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">target_rc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">area</span><span class="p">]</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">rc</span><span class="p">())</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">traces</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">target</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span> <span class="ow">or</span> <span class="n">target_rc</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">seq</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">matching_reads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">not_matching_reads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
            <span class="n">reads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matching_reads</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">matching_reads</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">not_matching_reads</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">reads</span> <span class="o">=</span> <span class="n">traces</span>

        <span class="n">matching_reads</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">read_</span> <span class="ow">in</span> <span class="n">reads</span><span class="p">:</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">_common_sub_strings</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="n">read_</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span> <span class="n">limit</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">newmatches</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                    <span class="n">g</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">matches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">g</span> <span class="o">+</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">f</span> <span class="o">+</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">newmatches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># len(matches)==1</span>
                <span class="n">newmatches</span> <span class="o">=</span> <span class="n">matches</span>

            <span class="n">matching_reads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newmatches</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ms</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">newmatches</span><span class="p">:</span>
                    <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_SimpleLocation</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">_CompoundLocation</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">newmatches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">_SimpleLocation</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">_SeqFeature</span><span class="p">(</span>
                    <span class="n">loc</span><span class="p">,</span>
                    <span class="n">qualifiers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">read_</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]]},</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;trace&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">annotations</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">matching_reads</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Dseqrecord(</span><span class="si">{}{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">({</span><span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">}[</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_repr_pretty_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">cycle</span><span class="p">):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;Dseqrecord(</span><span class="si">{}{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">({</span><span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">}[</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;seq&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span> <span class="s2">&quot;watson&quot;</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="n">other_five_prime</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">five_prime_end</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">other_five_prime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;5&#39;&quot;</span><span class="p">:</span>
                <span class="c1"># add other.seq.ovhg</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">location</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span>
            <span class="k">elif</span> <span class="n">other_five_prime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;3&#39;&quot;</span><span class="p">:</span>
                <span class="c1"># subtract other.seq.ovhg (sign change)</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">location</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">other</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span><span class="p">)</span>

            <span class="n">answer</span> <span class="o">=</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">_SeqRecord</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">_SeqRecord</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n</span>
        <span class="k">return</span> <span class="n">answer</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TypeError: can&#39;t multiply Dseqrecord by non-int of type </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">number</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;TypeError: can&#39;t multiply circular Dseqrecord.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
                <span class="n">new</span> <span class="o">+=</span> <span class="bp">self</span>
            <span class="k">return</span> <span class="n">new</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sl</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span>
        <span class="c1"># answer.seq.alphabet = self.seq.alphabet</span>
        <span class="c1"># breakpoint()</span>
        <span class="n">sl_start</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="mi">0</span>  <span class="c1"># 6</span>
        <span class="n">sl_stop</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">stop</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>  <span class="c1"># 1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span> <span class="ow">or</span> <span class="n">sl_start</span> <span class="o">&lt;</span> <span class="n">sl_stop</span><span class="p">:</span>
            <span class="c1"># TODO: special case for sl_end == 0 in circular sequences</span>
            <span class="c1"># related to https://github.com/BjornFJohansson/pydna/issues/161</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span> <span class="ow">and</span> <span class="n">sl</span><span class="o">.</span><span class="n">stop</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sl</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span> <span class="n">sl</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">sl</span><span class="p">)</span><span class="o">.</span><span class="n">features</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span> <span class="ow">and</span> <span class="n">sl_start</span> <span class="o">&gt;</span> <span class="n">sl_stop</span><span class="p">:</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shifted</span><span class="p">(</span><span class="n">sl_start</span><span class="p">)</span><span class="o">.</span><span class="n">features</span>
            <span class="c1"># origin-spanning features should only be included after shifting</span>
            <span class="c1"># in cases where the slice comprises the entire sequence, but then</span>
            <span class="c1"># sl_start == sl_stop and the second condition is not met</span>
            <span class="n">answer</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">f</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">answer</span><span class="o">.</span><span class="n">features</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">_location_boundaries</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">answer</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">length</span>
                    <span class="ow">and</span> <span class="n">_location_boundaries</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">_location_boundaries</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">]</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span> <span class="ow">and</span> <span class="n">sl_start</span> <span class="o">==</span> <span class="n">sl_stop</span><span class="p">:</span>
            <span class="n">cut</span> <span class="o">=</span> <span class="p">((</span><span class="n">sl_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">apply_cut</span><span class="p">(</span><span class="n">cut</span><span class="p">,</span> <span class="n">cut</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">answer</span> <span class="o">=</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">identifier</span> <span class="o">=</span> <span class="s2">&quot;part_</span><span class="si">{id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">answer</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">sf</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">answer</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>  <span class="c1"># default</span>
            <span class="k">if</span> <span class="s2">&quot;label&quot;</span> <span class="ow">in</span> <span class="n">sf</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                <span class="n">identifier</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="s2">&quot;note&quot;</span> <span class="ow">in</span> <span class="n">sf</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">:</span>
                <span class="n">identifier</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sf</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">[</span><span class="s2">&quot;note&quot;</span><span class="p">])</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">_identifier_from_string</span><span class="p">(</span><span class="n">identifier</span><span class="p">)[:</span><span class="mi">16</span><span class="p">]</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">_identifier_from_string</span><span class="p">(</span><span class="s2">&quot;part_</span><span class="si">{name}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))[:</span><span class="mi">16</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">answer</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">seq</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;__hash__ must be based on __eq__.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())))))</span>

<div class="viewcode-block" id="Dseqrecord.linearize"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.linearize">[docs]</a>    <span class="k">def</span> <span class="nf">linearize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">enzymes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Similar to `:func:cut`.</span>

<span class="sd">        Throws an exception if there is not excactly one cut</span>
<span class="sd">        i.e. none or more than one digestion products.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can only linearize circular molecules!&quot;</span><span class="p">)</span>
        <span class="n">fragments</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="o">*</span><span class="n">enzymes</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fragments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;More than one fragment is formed!&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">fragments</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The enzyme(s) do not cut!&quot;</span><span class="p">)</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">fragments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{name}</span><span class="s2">_lin&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">answer</span><span class="o">.</span><span class="n">id</span><span class="p">[:</span><span class="mi">16</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">fragments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Dseqrecord.no_cutters"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.no_cutters">[docs]</a>    <span class="k">def</span> <span class="nf">no_cutters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">_RestrictionBatch</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">no_cutters</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">batch</span> <span class="ow">or</span> <span class="n">CommOnly</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.unique_cutters"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.unique_cutters">[docs]</a>    <span class="k">def</span> <span class="nf">unique_cutters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">_RestrictionBatch</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">unique_cutters</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">batch</span> <span class="ow">or</span> <span class="n">CommOnly</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.once_cutters"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.once_cutters">[docs]</a>    <span class="k">def</span> <span class="nf">once_cutters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">_RestrictionBatch</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">once_cutters</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">batch</span> <span class="ow">or</span> <span class="n">CommOnly</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.twice_cutters"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.twice_cutters">[docs]</a>    <span class="k">def</span> <span class="nf">twice_cutters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">_RestrictionBatch</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">twice_cutters</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">batch</span> <span class="ow">or</span> <span class="n">CommOnly</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.n_cutters"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.n_cutters">[docs]</a>    <span class="k">def</span> <span class="nf">n_cutters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">_RestrictionBatch</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">n_cutters</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="n">batch</span> <span class="ow">or</span> <span class="n">CommOnly</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.cutters"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.cutters">[docs]</a>    <span class="k">def</span> <span class="nf">cutters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">_RestrictionBatch</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">cutters</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">batch</span> <span class="ow">or</span> <span class="n">CommOnly</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.number_of_cuts"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.number_of_cuts">[docs]</a>    <span class="k">def</span> <span class="nf">number_of_cuts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">enzymes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of cuts by digestion with the Restriction enzymes</span>
<span class="sd">        contained in the iterable.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">enzyme</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">))</span> <span class="k">for</span> <span class="n">enzyme</span> <span class="ow">in</span> <span class="n">_flatten</span><span class="p">(</span><span class="n">enzymes</span><span class="p">)])</span></div>

<div class="viewcode-block" id="Dseqrecord.cas9"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.cas9">[docs]</a>    <span class="k">def</span> <span class="nf">cas9</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">RNA</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="n">fragments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">rc</span><span class="p">()):</span>
            <span class="n">fragments</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">sl</span><span class="o">.</span><span class="n">start</span> <span class="p">:</span> <span class="n">sl</span><span class="o">.</span><span class="n">stop</span><span class="p">]</span> <span class="k">for</span> <span class="n">sl</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">cas9</span><span class="p">(</span><span class="n">RNA</span><span class="p">)]</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fragments</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Dseqrecord.reverse_complement"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.reverse_complement">[docs]</a>    <span class="k">def</span> <span class="nf">reverse_complement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reverse complement.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;ggaatt&quot;)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseqrecord(-6)</span>
<span class="sd">        &gt;&gt;&gt; a.seq</span>
<span class="sd">        Dseq(-6)</span>
<span class="sd">        ggaatt</span>
<span class="sd">        ccttaa</span>
<span class="sd">        &gt;&gt;&gt; a.reverse_complement().seq</span>
<span class="sd">        Dseq(-6)</span>
<span class="sd">        aattcc</span>
<span class="sd">        ttaagg</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>
<span class="sd">        pydna.dseq.Dseq.reverse_complement</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">reverse_complement</span><span class="p">())</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_rc&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">13</span><span class="p">])</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">+</span> <span class="s2">&quot;_rc&quot;</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;_rc&quot;</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">circular</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">circular</span>
        <span class="c1"># answer.seq._linear = self.seq.linear</span>
        <span class="k">return</span> <span class="n">answer</span></div>

    <span class="n">rc</span> <span class="o">=</span> <span class="n">reverse_complement</span>

    <span class="c1"># @_memorize(&quot;pydna.dseqrecord.Dseqrecord.synced&quot;)</span>
<div class="viewcode-block" id="Dseqrecord.synced"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.synced">[docs]</a>    <span class="k">def</span> <span class="nf">synced</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">25</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This method returns a new circular sequence (Dseqrecord object), which has been rotated</span>
<span class="sd">        in such a way that there is maximum overlap between the sequence and</span>
<span class="sd">        ref, which may be a string, Biopython Seq, SeqRecord object or</span>
<span class="sd">        another Dseqrecord object.</span>

<span class="sd">        The reason for using this could be to rotate a new recombinant plasmid so</span>
<span class="sd">        that it starts at the same position after cloning. See the example below:</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;gaat&quot;, circular=True)</span>
<span class="sd">        &gt;&gt;&gt; a.seq</span>
<span class="sd">        Dseq(o4)</span>
<span class="sd">        gaat</span>
<span class="sd">        ctta</span>
<span class="sd">        &gt;&gt;&gt; d = a[2:] + a[:2]</span>
<span class="sd">        &gt;&gt;&gt; d.seq</span>
<span class="sd">        Dseq(-4)</span>
<span class="sd">        atga</span>
<span class="sd">        tact</span>
<span class="sd">        &gt;&gt;&gt; insert=Dseqrecord(&quot;CCC&quot;)</span>
<span class="sd">        &gt;&gt;&gt; recombinant = (d+insert).looped()</span>
<span class="sd">        &gt;&gt;&gt; recombinant.seq</span>
<span class="sd">        Dseq(o7)</span>
<span class="sd">        atgaCCC</span>
<span class="sd">        tactGGG</span>
<span class="sd">        &gt;&gt;&gt; recombinant.synced(a).seq</span>
<span class="sd">        Dseq(o7)</span>
<span class="sd">        gaCCCat</span>
<span class="sd">        ctGGGta</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Only circular DNA can be synced!&quot;</span><span class="p">)</span>

        <span class="n">newseq</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">s_rc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="s2">&quot;seq&quot;</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">seq</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="s2">&quot;watson&quot;</span><span class="p">):</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="n">lim</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">//</span> <span class="n">limit</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">_common_sub_strings</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">s</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">lim</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">_common_sub_strings</span><span class="p">(</span><span class="n">s_rc</span> <span class="o">+</span> <span class="n">s_rc</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">lim</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;There is no overlap between sequences!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">start_rc</span><span class="p">,</span> <span class="n">length_rc</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_rc</span><span class="p">,</span> <span class="n">length_rc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">length_rc</span> <span class="o">&gt;</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">start_rc</span>
            <span class="n">newseq</span> <span class="o">=</span> <span class="n">newseq</span><span class="o">.</span><span class="n">rc</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">newseq</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">newseq</span><span class="o">.</span><span class="n">shifted</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">_module_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;synced&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Dseqrecord.upper"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.upper">[docs]</a>    <span class="k">def</span> <span class="nf">upper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an uppercase copy.</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; my_seq = Dseqrecord(&quot;aAa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; my_seq.seq</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        aAa</span>
<span class="sd">        tTt</span>
<span class="sd">        &gt;&gt;&gt; upper = my_seq.upper()</span>
<span class="sd">        &gt;&gt;&gt; upper.seq</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        AAA</span>
<span class="sd">        TTT</span>
<span class="sd">        &gt;&gt;&gt;</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dseqrecord</span>
<span class="sd">            Dseqrecord object in uppercase</span>


<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pydna.dseqrecord.Dseqrecord.lower&quot;&quot;&quot;</span>

        <span class="n">upper</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">upper</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">upper</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">upper</span></div>

<div class="viewcode-block" id="Dseqrecord.lower"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.lower">[docs]</a>    <span class="k">def</span> <span class="nf">lower</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; my_seq = Dseqrecord(&quot;aAa&quot;)</span>
<span class="sd">        &gt;&gt;&gt; my_seq.seq</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        aAa</span>
<span class="sd">        tTt</span>
<span class="sd">        &gt;&gt;&gt; upper = my_seq.upper()</span>
<span class="sd">        &gt;&gt;&gt; upper.seq</span>
<span class="sd">        Dseq(-3)</span>
<span class="sd">        AAA</span>
<span class="sd">        TTT</span>
<span class="sd">        &gt;&gt;&gt; lower = my_seq.lower()</span>
<span class="sd">        &gt;&gt;&gt; lower</span>
<span class="sd">        Dseqrecord(-3)</span>
<span class="sd">        &gt;&gt;&gt;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dseqrecord</span>
<span class="sd">            Dseqrecord object in lowercase</span>

<span class="sd">        See also</span>
<span class="sd">        --------</span>
<span class="sd">        pydna.dseqrecord.Dseqrecord.upper</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">lower</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">lower</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">lower</span></div>

<div class="viewcode-block" id="Dseqrecord.orfs"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.orfs">[docs]</a>    <span class="k">def</span> <span class="nf">orfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minsize</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">Dseqrecord</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">y</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">orfs</span><span class="p">(</span><span class="n">minsize</span><span class="o">=</span><span class="n">minsize</span><span class="p">))</span></div>

<div class="viewcode-block" id="Dseqrecord.orfs_to_features"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.orfs_to_features">[docs]</a>    <span class="k">def</span> <span class="nf">orfs_to_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minsize</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">strand</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">rc</span><span class="p">())):</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">orfs</span><span class="p">(</span><span class="n">minsize</span><span class="o">=</span><span class="n">minsize</span><span class="p">):</span>
                <span class="n">orf</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">x</span><span class="p">:</span><span class="n">y</span><span class="p">]</span>
                <span class="n">prt</span> <span class="o">=</span> <span class="n">orf</span><span class="o">.</span><span class="n">translate</span><span class="p">()</span>
                <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">_SeqFeature</span><span class="p">(</span>
                        <span class="n">_SimpleLocation</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">strand</span><span class="o">=</span><span class="n">strand</span><span class="p">),</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;CDS&quot;</span><span class="p">,</span>
                        <span class="n">qualifiers</span><span class="o">=</span><span class="p">{</span>
                            <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="si">}</span><span class="s2">bp </span><span class="si">{</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">3</span><span class="si">}</span><span class="s2">aa&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;checksum&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">orf</span><span class="o">.</span><span class="n">seguid</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; (DNA)&quot;</span><span class="p">,</span> <span class="n">prt</span><span class="o">.</span><span class="n">seguid</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; (protein)&quot;</span><span class="p">],</span>
                            <span class="s2">&quot;codon_start&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="s2">&quot;transl_table&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
                            <span class="s2">&quot;translation&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">prt</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span>
                        <span class="p">},</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">features</span></div>

    <span class="k">def</span> <span class="nf">_copy_to_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence_format</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">pyperclip</span> <span class="kn">import</span> <span class="n">copy</span>

        <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sequence_format</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="Dseqrecord.copy_gb_to_clipboard"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.copy_gb_to_clipboard">[docs]</a>    <span class="k">def</span> <span class="nf">copy_gb_to_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_to_clipboard</span><span class="p">(</span><span class="s2">&quot;gb&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dseqrecord.copy_fasta_to_clipboard"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.copy_fasta_to_clipboard">[docs]</a>    <span class="k">def</span> <span class="nf">copy_fasta_to_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_to_clipboard</span><span class="p">(</span><span class="s2">&quot;fasta&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Dseqrecord.figure"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.figure">[docs]</a>    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[48;5;11m&quot;</span><span class="p">,</span> <span class="n">plain</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;docstring.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
            <span class="n">locations</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">parts</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">_SimpleLocation</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">fget</span><span class="p">)</span>
            <span class="n">strand</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">strand</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">locations</span> <span class="o">=</span> <span class="p">[</span><span class="n">_SimpleLocation</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
            <span class="n">strand</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">ovhg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">crick</span><span class="p">)</span>

        <span class="n">w</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">watson</span><span class="si">}{</span><span class="o">-</span><span class="n">ovhg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">c</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">ovhg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">crick</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}{</span><span class="n">ovhg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">strand</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">w</span>

        <span class="n">wfe</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">highlight</span><span class="si">}{</span><span class="n">s1</span><span class="p">[</span><span class="n">part</span><span class="o">.</span><span class="n">start</span><span class="p">:</span><span class="n">part</span><span class="o">.</span><span class="n">end</span><span class="p">]</span><span class="si">}{</span><span class="n">plain</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">locations</span><span class="p">]</span>

        <span class="n">wfe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="n">wof</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">locations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">locations</span><span class="p">,</span> <span class="n">locations</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="n">wof</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">end</span> <span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">start</span><span class="p">])</span>
        <span class="n">wof</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s1</span><span class="p">[</span><span class="n">locations</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">end</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)])</span>

        <span class="n">topology</span> <span class="o">=</span> <span class="p">{</span><span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">}[</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">topology</span><span class="si">}{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="n">s1</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="n">s</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wof</span><span class="p">,</span> <span class="n">wfe</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">strand</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s1</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">s2</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s2</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">s1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">_pretty_str</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.shifted"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.shifted">[docs]</a>    <span class="k">def</span> <span class="nf">shifted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shift</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Circular Dseqrecord with a new origin &lt;shift&gt;.</span>

<span class="sd">        This only works on circular Dseqrecords. If we consider the following</span>
<span class="sd">        circular sequence:</span>


<span class="sd">        | ``GAAAT   &lt;-- watson strand``</span>
<span class="sd">        | ``CTTTA   &lt;-- crick strand``</span>

<span class="sd">        The T and the G on the watson strand are linked together as well</span>
<span class="sd">        as the A and the C of the of the crick strand.</span>

<span class="sd">        if ``shift`` is 1, this indicates a new origin at position 1:</span>

<span class="sd">        |    new origin at the | symbol:</span>
<span class="sd">        |</span>
<span class="sd">        | ``G|AAAT``</span>
<span class="sd">        | ``C|TTTA``</span>

<span class="sd">        new sequence:</span>

<span class="sd">        | ``AAATG``</span>
<span class="sd">        | ``TTTAC``</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;aaat&quot;,circular=True)</span>
<span class="sd">        &gt;&gt;&gt; a</span>
<span class="sd">        Dseqrecord(o4)</span>
<span class="sd">        &gt;&gt;&gt; a.seq</span>
<span class="sd">        Dseq(o4)</span>
<span class="sd">        aaat</span>
<span class="sd">        ttta</span>
<span class="sd">        &gt;&gt;&gt; b=a.shifted(1)</span>
<span class="sd">        &gt;&gt;&gt; b</span>
<span class="sd">        Dseqrecord(o4)</span>
<span class="sd">        &gt;&gt;&gt; b.seq</span>
<span class="sd">        Dseq(o4)</span>
<span class="sd">        aata</span>
<span class="sd">        ttat</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">circular</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Sequence is linear, origin can only be &quot;</span> <span class="s2">&quot;shifted for circular sequences.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">shift</span> <span class="o">%</span> <span class="n">ln</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># shift is a multiple of ln or 0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shift</span> <span class="o">%=</span> <span class="n">ln</span>  <span class="c1"># 0&lt;=shift&lt;=ln</span>
        <span class="n">newseq</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">shift</span><span class="p">:]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[:</span><span class="n">shift</span><span class="p">])</span><span class="o">.</span><span class="n">looped</span><span class="p">()</span>
        <span class="n">newfeatures</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">newfeatures</span><span class="p">:</span>
            <span class="n">feature</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="n">_shift_location</span><span class="p">(</span><span class="n">feature</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="o">-</span><span class="n">shift</span><span class="p">,</span> <span class="n">ln</span><span class="p">)</span>
        <span class="n">newfeatures</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">_operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;location.start&quot;</span><span class="p">))</span>
        <span class="n">answer</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="n">newfeatures</span>
        <span class="n">answer</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">newseq</span>
        <span class="k">return</span> <span class="n">answer</span></div>

<div class="viewcode-block" id="Dseqrecord.cut"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.cut">[docs]</a>    <span class="k">def</span> <span class="nf">cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">enzymes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Digest a Dseqrecord object with one or more restriction enzymes.</span>

<span class="sd">        returns a list of linear Dseqrecords. If there are no cuts, an empty</span>
<span class="sd">        list is returned.</span>

<span class="sd">        See also :func:`Dseq.cut`</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        enzymes : enzyme object or iterable of such objects</span>
<span class="sd">            A Bio.Restriction.XXX restriction object or iterable of such.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Dseqrecord_frags : list</span>
<span class="sd">            list of Dseqrecord objects formed by the digestion</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pydna.dseqrecord import Dseqrecord</span>
<span class="sd">        &gt;&gt;&gt; a=Dseqrecord(&quot;ggatcc&quot;)</span>
<span class="sd">        &gt;&gt;&gt; from Bio.Restriction import BamHI</span>
<span class="sd">        &gt;&gt;&gt; a.cut(BamHI)</span>
<span class="sd">        (Dseqrecord(-5), Dseqrecord(-5))</span>
<span class="sd">        &gt;&gt;&gt; frag1, frag2 = a.cut(BamHI)</span>
<span class="sd">        &gt;&gt;&gt; frag1.seq</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        g</span>
<span class="sd">        cctag</span>
<span class="sd">        &gt;&gt;&gt; frag2.seq</span>
<span class="sd">        Dseq(-5)</span>
<span class="sd">        gatcc</span>
<span class="sd">            g</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cutsites</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">get_cutsites</span><span class="p">(</span><span class="o">*</span><span class="n">enzymes</span><span class="p">)</span>
        <span class="n">cutsite_pairs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">get_cutsite_pairs</span><span class="p">(</span><span class="n">cutsites</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_cut</span><span class="p">(</span><span class="o">*</span><span class="n">cs</span><span class="p">)</span> <span class="k">for</span> <span class="n">cs</span> <span class="ow">in</span> <span class="n">cutsite_pairs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Dseqrecord.apply_cut"><a class="viewcode-back" href="../../modules/pydna_dseqrecord.html#pydna.all.Dseqrecord.apply_cut">[docs]</a>    <span class="k">def</span> <span class="nf">apply_cut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left_cut</span><span class="p">,</span> <span class="n">right_cut</span><span class="p">):</span>
        <span class="n">dseq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">apply_cut</span><span class="p">(</span><span class="n">left_cut</span><span class="p">,</span> <span class="n">right_cut</span><span class="p">)</span>
        <span class="c1"># TODO: maybe remove depending on https://github.com/BjornFJohansson/pydna/issues/161</span>

        <span class="k">if</span> <span class="n">left_cut</span> <span class="o">==</span> <span class="n">right_cut</span><span class="p">:</span>
            <span class="c1"># Not really a cut, but to handle the general case</span>
            <span class="k">if</span> <span class="n">left_cut</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">features</span> <span class="o">=</span> <span class="n">_copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># The features that span the origin if shifting with left_cut, but that do not cross</span>
                <span class="c1"># the cut site should be included, and if there is a feature within the cut site, it should</span>
                <span class="c1"># be duplicated. See https://github.com/BjornFJohansson/pydna/issues/180 for a practical example.</span>
                <span class="c1">#</span>
                <span class="c1"># Let&#39;s say we are going to open a circular plasmid like below (| inidicate cuts, numbers indicate</span>
                <span class="c1"># features)</span>
                <span class="c1">#</span>
                <span class="c1">#    3333|3</span>
                <span class="c1">#    1111</span>
                <span class="c1">#     000</span>
                <span class="c1"># XXXXatg|YYY</span>
                <span class="c1"># XXX|tacYYYY</span>
                <span class="c1">#     000</span>
                <span class="c1">#     2222</span>
                <span class="c1">#</span>
                <span class="n">left_watson</span><span class="p">,</span> <span class="n">left_crick</span><span class="p">,</span> <span class="n">left_ovhg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">get_cut_parameters</span><span class="p">(</span><span class="n">left_cut</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">initial_shift</span> <span class="o">=</span> <span class="n">left_watson</span> <span class="k">if</span> <span class="n">left_ovhg</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">left_crick</span>
                <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shifted</span><span class="p">(</span><span class="n">initial_shift</span><span class="p">)</span><span class="o">.</span><span class="n">features</span>
                <span class="c1"># for f in features:</span>
                <span class="c1">#     print(f.id, f.location, _location_boundaries(f.location))</span>
                <span class="c1"># Here, we have done what&#39;s shown below (* indicates the origin).</span>
                <span class="c1"># The features 0 and 2 have the right location for the final product:</span>
                <span class="c1">#</span>
                <span class="c1">#    3*3333</span>
                <span class="c1">#    1*111</span>
                <span class="c1"># XXXX*atgYYY</span>
                <span class="c1"># XXXX*tacYYY</span>
                <span class="c1">#      000</span>
                <span class="c1">#      2222</span>

                <span class="n">features_need_transfer</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="p">(</span><span class="n">_location_boundaries</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">left_ovhg</span><span class="p">))</span>
                <span class="p">]</span>
                <span class="n">features_need_transfer</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">_shift_feature</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">left_ovhg</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features_need_transfer</span>
                <span class="p">]</span>

                <span class="c1">#                                           ^                ^^^^^^^^^</span>
                <span class="c1"># Now we have shifted the features that end before the cut (0 and 1, but not 3), as if</span>
                <span class="c1"># they referred to the below sequence (* indicates the origin):</span>
                <span class="c1">#</span>
                <span class="c1">#    1111</span>
                <span class="c1">#     000</span>
                <span class="c1"># XXXXatg*YYY</span>
                <span class="c1"># XXXXtac*YYY</span>
                <span class="c1">#</span>
                <span class="c1"># The features 0 and 1 would have the right location if the final sequence had the same length</span>
                <span class="c1"># as the original one. However, the final product is longer because of the overhang.</span>

                <span class="n">features</span> <span class="o">+=</span> <span class="p">[</span><span class="n">_shift_feature</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">left_ovhg</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">dseq</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features_need_transfer</span><span class="p">]</span>
                <span class="c1">#                             ^                ^^^^^^^^^</span>
                <span class="c1"># So we shift back by the same amount in the opposite direction, but this time we pass the</span>
                <span class="c1"># length of the final product.</span>
                <span class="c1"># print(*features, sep=&#39;\n&#39;)</span>
                <span class="c1"># Features like 3 are removed here</span>
                <span class="n">features</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">f</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="n">_location_boundaries</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dseq</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">_location_boundaries</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">_location_boundaries</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">location</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">left_watson</span><span class="p">,</span> <span class="n">left_crick</span><span class="p">,</span> <span class="n">left_ovhg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">get_cut_parameters</span><span class="p">(</span><span class="n">left_cut</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">right_watson</span><span class="p">,</span> <span class="n">right_crick</span><span class="p">,</span> <span class="n">right_ovhg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="o">.</span><span class="n">get_cut_parameters</span><span class="p">(</span><span class="n">right_cut</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">left_edge</span> <span class="o">=</span> <span class="n">left_crick</span> <span class="k">if</span> <span class="n">left_ovhg</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">left_watson</span>
            <span class="n">right_edge</span> <span class="o">=</span> <span class="n">right_watson</span> <span class="k">if</span> <span class="n">right_ovhg</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">right_crick</span>
            <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">left_edge</span><span class="p">:</span><span class="n">right_edge</span><span class="p">]</span><span class="o">.</span><span class="n">features</span>

        <span class="k">return</span> <span class="n">Dseqrecord</span><span class="p">(</span><span class="n">dseq</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="n">_os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;pydna_cache&quot;</span><span class="p">)</span>
    <span class="n">_os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;pydna_cache&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;nocache&quot;</span>
    <span class="kn">import</span> <span class="nn">doctest</span>

    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">optionflags</span><span class="o">=</span><span class="n">doctest</span><span class="o">.</span><span class="n">ELLIPSIS</span><span class="p">)</span>
    <span class="c1"># _os.environ[&quot;pydna_cache&quot;] = cache</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Bj√∂rn F. Johansson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>